<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NutriTrack - Dein Ernährungs-Tracker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel für JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Robuste Icon-Komponente (SVG-basiert) ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                Plus: <path d="M5 12h14m-7-7v14"/>,
                Trash2: <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2m-6 9h4m-4-4h4"/>,
                Utensils: <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>,
                Settings: <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2Z"/><circle cx="12" cy="12" r="3"/>,
                ChevronLeft: <path d="m15 18-6-6 6-6"/>,
                ChevronRight: <path d="m9 18 6-6-6-6"/>,
                Search: <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>,
                Database: <ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/><path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"/>,
                Upload: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4m14-7-5-5-5 5m5-5v12"/>,
                CheckCircle2: <circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/>,
                X: <path d="M18 6 6 18M6 6l12 12"/>,
                Save: <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>,
                Sparkles: <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>,
                Loader2: <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48 2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48 2.83-2.83"/>,
                BrainCircuit: <path d="M12 4.5V12m0 0 4.5 4.5M12 12l-4.5 4.5M8 4.5h8m-8 15h8"/><circle cx="12" cy="12" r="9"/>,
                Copy: <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>,
                Pencil: <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <path d="M12 2v20M2 12h20"/>}
                </svg>
            );
        };

        const apiKey = ""; 
        const GEMINI_MODEL = "gemini-2.5-flash-preview-09-2025";

        const App = () => {
            const getTodayStr = () => new Date().toISOString().split('T')[0];
            const getDayName = (dateStr) => new Date(dateStr).toLocaleDateString('de-DE', { weekday: 'long' });
            const getDayIndex = (dateStr) => new Date(dateStr).getDay();

            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('nutri_logs_v10')) || []);
            const [foodDatabase, setFoodDatabase] = useState(() => JSON.parse(localStorage.getItem('nutri_db_v10')) || []);
            const [goals, setGoals] = useState(() => {
                const saved = localStorage.getItem('nutri_goals_v10');
                if (saved) return JSON.parse(saved);
                const def = { calories: 2192, protein: 150, carbs: 250, fat: 60, fiber: 30 };
                const initial = {};
                [0,1,2,3,4,5,6].forEach(d => initial[d] = { ...def });
                return initial;
            });
            
            const [selectedDate, setSelectedDate] = useState(getTodayStr());
            const [activeTab, setActiveTab] = useState('diary'); 
            const [showSettings, setShowSettings] = useState(false);
            const [settingsDay, setSettingsDay] = useState(getDayIndex(getTodayStr())); 
            const [showAddModal, setShowAddModal] = useState(false);
            const [notification, setNotification] = useState(null);
            const [isImporting, setIsImporting] = useState(false);
            const [viewMonth, setViewMonth] = useState(new Date());
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedFood, setSelectedFood] = useState(null); 
            const [editingLog, setEditingLog] = useState(null);
            const [amount, setAmount] = useState(100);
            const [calcMode, setCalcMode] = useState('per100g'); 
            const [quickTrack, setQuickTrack] = useState({ name: '', protein: '', fat: '', carbs: '', fiber: '', kcal: '' });
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [aiSuggestions, setAiSuggestions] = useState(null);

            const fileInputRef = useRef(null);

            useEffect(() => { localStorage.setItem('nutri_logs_v10', JSON.stringify(logs)); }, [logs]);
            useEffect(() => { localStorage.setItem('nutri_db_v10', JSON.stringify(foodDatabase)); }, [foodDatabase]);
            useEffect(() => { localStorage.setItem('nutri_goals_v10', JSON.stringify(goals)); }, [goals]);

            const currentDayGoals = goals[getDayIndex(selectedDate)];
            const dailyLogs = logs.filter(log => log.date === selectedDate);

            const totals = dailyLogs.reduce((acc, curr) => ({
                calories: acc.calories + (curr.calories * (curr.amount / 100)),
                protein: acc.protein + (curr.protein * (curr.amount / 100)),
                carbs: acc.carbs + (curr.carbs * (curr.amount / 100)),
                fat: acc.fat + (curr.fat * (curr.amount / 100)),
                fiber: acc.fiber + ((curr.fiber || 0) * (curr.amount / 100)),
            }), { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0 });

            const filteredDB = searchQuery.length >= 2 ? foodDatabase.filter(item => item.name.toLowerCase().includes(searchQuery.toLowerCase())).slice(0, 30) : [];
            const loggedDays = new Set(logs.map(l => l.date));

            const callGemini = async (prompt) => {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${apiKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text;
            };

            const handleAiAnalyzeRecipe = async () => {
                if (!quickTrack.name) return showToast("Bitte Text eingeben.");
                setIsAiLoading(true);
                try {
                    const res = await callGemini(`Analysiere Rezept: "${quickTrack.name}". Schätze Nährwerte pro 100g oder gesamt. JSON: { "name": string, "kcal": number, "protein": number, "fat": number, "carbs": number, "fiber": number, "isPer100g": boolean }.`);
                    const p = JSON.parse(res);
                    setQuickTrack({ name: p.name, kcal: p.kcal.toString(), protein: p.protein.toString(), fat: p.fat.toString(), carbs: p.carbs.toString(), fiber: p.fiber.toString() });
                    setCalcMode(p.isPer100g ? 'per100g' : 'total');
                    showToast("KI-Analyse fertig! ✨");
                } catch (e) { showToast("KI Fehler."); } finally { setIsAiLoading(false); }
            };

            const handleAiSuggestMeal = async () => {
                setIsAiLoading(true);
                try {
                    const rem = { kcal: currentDayGoals.calories - totals.calories, p: currentDayGoals.protein - totals.protein };
                    const res = await callGemini(`Tag: ${getDayName(selectedDate)}. Verbleibend: ${Math.round(rem.kcal)}kcal, ${Math.round(rem.p)}g P. Schlage 3 Mahlzeiten vor als JSON: { "suggestions": [{ "title": string, "desc": string, "macros": string }] }`);
                    setAiSuggestions(JSON.parse(res).suggestions);
                } catch (e) { showToast("KI Fehler."); } finally { setIsAiLoading(false); }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsImporting(true);
                const reader = new FileReader();
                reader.onload = (event) => {
                    const rows = event.target.result.split(/\r?\n/);
                    const header = rows[0].split(';');
                    const find = (s) => header.findIndex(h => h.toLowerCase().includes(s.toLowerCase()));
                    const idx = { n: find('Lebensmittelbezeichnung'), k: find('Energie'), p: find('Protein'), f: find('Fett'), c: find('Kohlenhydrate'), b: find('Ballaststoffe') };
                    const data = rows.slice(1).map((r, i) => {
                        const c = r.split(';'); if (c.length < 5 || !c[idx.n]) return null;
                        const cv = (v) => v ? parseFloat(v.replace(/"/g, '').replace(',', '.')) || 0 : 0;
                        return { id: `bls-${i}`, name: c[idx.n].replace(/"/g, ''), calories: cv(c[idx.k]), protein: cv(c[idx.p]), fat: cv(c[idx.f]), carbs: cv(c[idx.c]), fiber: cv(c[idx.b]) };
                    }).filter(x => x);
                    setFoodDatabase(data); setIsImporting(false); showToast(`${data.length} Items geladen.`);
                };
                reader.readAsText(file);
            };

            const addLogEntry = (f, g) => {
                setLogs([{ ...f, id: Date.now(), amount: g, date: selectedDate, timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }, ...logs]);
                resetAddState(); showToast("Hinzugefügt!");
            };

            const resetAddState = () => { setShowAddModal(false); setSelectedFood(null); setEditingLog(null); setSearchQuery(''); setAmount(100); setQuickTrack({ name: '', protein: '', fat: '', carbs: '', fiber: '', kcal: '' }); };
            const showToast = (m) => { setNotification(m); setTimeout(() => setNotification(null), 3000); };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900 pb-24 font-sans select-none">
                    <nav className="bg-white border-b sticky top-0 z-40 shadow-sm">
                        <div className="max-w-md mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-2 text-emerald-600 font-black text-xl tracking-tighter"><Icon name="Utensils" size={24}/> NutriTrack</div>
                            <button onClick={() => { setSettingsDay(getDayIndex(selectedDate)); setShowSettings(true); }} className="p-2 text-slate-400"><Icon name="Settings" size={22}/></button>
                        </div>
                        {activeTab === 'diary' && (
                            <div className="max-w-md mx-auto px-4 py-2 flex justify-between items-center bg-slate-50/50 border-t">
                                <button onClick={() => setSelectedDate(d => { const date = new Date(d); date.setDate(date.getDate()-1); return date.toISOString().split('T')[0]; })}><Icon name="ChevronLeft" size={20} className="text-slate-400"/></button>
                                <div className="text-center"><p className="text-[10px] font-black text-emerald-600 uppercase">{getDayName(selectedDate)}</p><p className="text-xs font-bold text-slate-600">{selectedDate === getTodayStr() ? 'Heute' : new Date(selectedDate).toLocaleDateString('de-DE', { day: '2-digit', month: 'short' })}</p></div>
                                <button onClick={() => setSelectedDate(d => { const date = new Date(d); date.setDate(date.getDate()+1); return date.toISOString().split('T')[0]; })}><Icon name="ChevronRight" size={20} className="text-slate-400"/></button>
                            </div>
                        )}
                    </nav>

                    <div className="max-w-md mx-auto px-4 mt-4 flex bg-slate-200/50 p-1.5 rounded-2xl gap-1">
                        {['diary', 'database', 'calendar'].map(t => (
                            <button key={t} onClick={() => setActiveTab(t)} className={`flex-1 py-2.5 text-[11px] font-black uppercase rounded-xl transition-all ${activeTab === t ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-500'}`}>
                                {t === 'diary' ? 'Tagebuch' : t === 'database' ? 'DB' : 'Kalender'}
                            </button>
                        ))}
                    </div>

                    <main className="max-w-md mx-auto px-4 py-6">
                        {activeTab === 'diary' && (
                            <div className="space-y-6">
                                {!aiSuggestions ? (
                                    <button onClick={handleAiSuggestMeal} disabled={isAiLoading} className="w-full bg-white border border-emerald-100 rounded-3xl p-5 flex items-center justify-between shadow-sm active:scale-95 transition-all">
                                        <div className="flex items-center gap-4"><div className="bg-emerald-50 p-3 rounded-2xl text-emerald-500">{isAiLoading ? <Icon name="Loader2" size={24} className="animate-spin" /> : <Icon name="Sparkles" size={24} />}</div><div className="text-left font-bold text-sm">KI Mahlzeiten Coach ✨<p className="text-[10px] font-normal text-slate-400 uppercase tracking-widest">Für deine Rest-Makros</p></div></div>
                                        <Icon name="ChevronRight" size={18} className="text-slate-200" />
                                    </button>
                                ) : (
                                    <div className="bg-white rounded-3xl p-6 border border-emerald-100 animate-in fade-in slide-in-from-top-2">
                                        <div className="flex justify-between items-center mb-4"><h4 className="font-black text-sm uppercase text-emerald-600 flex items-center gap-2"><Icon name="Sparkles" size={16}/> Vorschläge</h4><button onClick={() => setAiSuggestions(null)}><Icon name="X" size={18} className="text-slate-300"/></button></div>
                                        <div className="space-y-3">{aiSuggestions.map((s, i) => (<div key={i} className="bg-slate-50 p-4 rounded-2xl border border-slate-100"><p className="text-xs font-black text-slate-800 uppercase">{s.title}</p><p className="text-[11px] text-slate-500 mb-2">{s.desc}</p><p className="text-[10px] font-black text-emerald-600">{s.macros}</p></div>))}</div>
                                    </div>
                                )}

                                <section className="bg-white rounded-[40px] p-8 shadow-sm border border-slate-100">
                                    <div className="flex justify-between items-end mb-6">
                                        <div><p className="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-1">Rest kcal</p><h2 className="text-5xl font-black text-slate-800 tracking-tighter">{Math.round(currentDayGoals.calories - totals.calories)} <span className="text-lg font-medium text-slate-300">kcal</span></h2></div>
                                        <div className="text-right text-[10px] font-black text-slate-300 uppercase">Ziel: {currentDayGoals.calories}</div>
                                    </div>
                                    <div className="w-full h-4 bg-slate-100 rounded-full overflow-hidden mb-8"><div className={`h-full transition-all duration-1000 ${totals.calories > currentDayGoals.calories ? 'bg-rose-500' : 'bg-emerald-500'}`} style={{ width: `${Math.min((totals.calories / currentDayGoals.calories) * 100, 100)}%` }}></div></div>
                                    <div className="grid grid-cols-4 gap-2">
                                        {[ {l:'P',v:totals.protein,c:'blue'}, {l:'F',v:totals.fat,c:'rose'}, {l:'C',v:totals.carbs,c:'amber'}, {l:'B',v:totals.fiber,c:'emerald'} ].map(m => (<div key={m.l} className={`bg-${m.c}-50 border border-${m.c}-100 rounded-2xl p-3 text-center`}><p className="text-[9px] font-black uppercase mb-1">{m.l}</p><p className="font-bold text-xs">{Math.round(m.v)}g</p></div>))}
                                    </div>
                                </section>

                                <div className="space-y-4">
                                    <div className="flex justify-between items-center px-2"><h3 className="font-black text-slate-800 text-lg">Mahlzeiten</h3><button onClick={() => setShowAddModal(true)} className="bg-emerald-600 text-white w-10 h-10 rounded-2xl flex items-center justify-center shadow-lg active:scale-90 transition-transform"><Icon name="Plus" size={24}/></button></div>
                                    {dailyLogs.length === 0 ? <div className="bg-white rounded-[32px] p-16 text-center border-dashed border-2 text-slate-300 italic">Keine Einträge</div> : 
                                        dailyLogs.map(item => (<div key={item.id} className="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex justify-between items-center animate-in fade-in"><div className="flex-1 font-black text-sm">{item.name}<p className="text-xs font-bold text-slate-400 mt-1">{item.amount}g • {Math.round(item.calories * (item.amount/100))} kcal</p></div><div className="flex gap-1"><button onClick={() => { setEditingLog(item); setAmount(item.amount); }} className="p-2 text-slate-200 hover:text-emerald-500"><Icon name="Pencil" size={18}/></button><button onClick={() => setLogs(logs.filter(l => l.id !== item.id))} className="p-2 text-slate-200 hover:text-rose-500"><Icon name="Trash2" size={18}/></button></div></div>))
                                    }
                                </div>
                            </div>
                        )}

                        {activeTab === 'database' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center px-1"><h3 className="font-black text-lg">BLS 4.0</h3><button onClick={() => fileInputRef.current.click()} className="text-xs font-black text-emerald-600 bg-emerald-50 px-4 py-2.5 rounded-2xl flex items-center gap-2"><Icon name="Upload" size={16}/> Import</button><input type="file" ref={fileInputRef} className="hidden" accept=".csv" onChange={handleFileUpload} /></div>
                                <div className="bg-white rounded-[40px] p-16 text-center border border-slate-100"><Icon name="Database" size={56} className="mx-auto mb-6 text-slate-100" /><p className="text-sm text-slate-400 font-medium font-black text-slate-800">{foodDatabase.length} Einträge geladen.</p></div>
                            </div>
                        )}

                        {activeTab === 'calendar' && (
                            <div className="bg-white rounded-[40px] p-8 shadow-sm border border-slate-100">
                                <div className="flex justify-between items-center mb-8"><button onClick={() => setViewMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()-1))}><Icon name="ChevronLeft" size={24}/></button><h3 className="font-black text-xl">{viewMonth.toLocaleDateString('de-DE', { month: 'long', year: 'numeric' })}</h3><button onClick={() => setViewMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1))}><Icon name="ChevronRight" size={24}/></button></div>
                                <div className="grid grid-cols-7 gap-2 text-center mb-4">{['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'].map(d => <div key={d} className="text-[10px] font-black text-slate-300 uppercase">{d}</div>)}</div>
                                <div className="grid grid-cols-7 gap-2">
                                    {(() => {
                                        const dArr = []; const fD = new Date(viewMonth.getFullYear(), viewMonth.getMonth(), 1).getDay(); const pad = fD === 0 ? 6 : fD - 1; const dIM = new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1, 0).getDate();
                                        for(let i=0; i<pad; i++) dArr.push(null); for(let d=1; d<=dIM; d++) dArr.push(new Date(viewMonth.getFullYear(), viewMonth.getMonth(), d));
                                        return dArr.map((date, i) => {
                                            if(!date) return <div key={i}/>;
                                            const ds = date.toISOString().split('T')[0];
                                            const isSelected = ds === selectedDate;
                                            return (<button key={ds} onClick={() => { setSelectedDate(ds); setActiveTab('diary'); }} className={`aspect-square flex flex-col items-center justify-center rounded-2xl text-sm font-black relative active:scale-90 transition-all ${isSelected ? 'bg-emerald-600 text-white shadow-lg' : 'text-slate-600 hover:bg-slate-50'}`}>{date.getDate()}{loggedDays.has(ds) && <div className={`w-1.5 h-1.5 rounded-full mt-1 ${isSelected ? 'bg-white' : 'bg-emerald-500'}`}/>}</button>);
                                        });
                                    })()}
                                </div>
                            </div>
                        )}
                    </main>

                    {showAddModal && (
                        <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-50 flex items-end justify-center p-4">
                            <div className="bg-white w-full max-w-md rounded-[48px] p-8 max-h-[90vh] overflow-y-auto custom-scrollbar animate-slide-up">
                                <div className="flex justify-between items-center mb-8 sticky top-0 bg-white z-10 pb-2"><h3 className="text-2xl font-black">Tracken</h3><button onClick={resetAddState} className="bg-slate-100 p-2.5 rounded-full"><Icon name="X" size={20}/></button></div>
                                <div className="relative mb-8 flex bg-slate-50 rounded-3xl border px-5 items-center"><Icon name="Search" size={20} className="text-slate-400"/><input type="text" placeholder="Suche..." className="w-full bg-transparent p-5 text-sm font-bold outline-none" value={searchQuery} onChange={e => setSearchQuery(e.target.value)}/>
                                    {filteredDB.length > 0 && (<div className="absolute top-full left-0 right-0 mt-3 bg-white rounded-3xl shadow-2xl border max-h-60 overflow-y-auto z-50">{filteredDB.map(f => (<button key={f.id} onClick={() => { setSelectedFood(f); setSearchQuery(''); }} className="w-full text-left p-5 border-b hover:bg-emerald-50 font-black text-sm">{f.name}<p className="text-[10px] text-slate-400">100g: {f.calories} kcal</p></button>))}</div>)}
                                </div>
                                <form onSubmit={handleQuickTrack} className="space-y-6">
                                    <div className="relative"><textarea placeholder="z.B. 2 Eier, Avocado..." className="w-full bg-slate-50 rounded-3xl p-5 text-sm min-h-[100px] outline-none border focus:border-emerald-200" value={quickTrack.name} onChange={e => setQuickTrack({...quickTrack, name: e.target.value})}/><button type="button" onClick={handleAiAnalyzeRecipe} disabled={isAiLoading} className="absolute right-4 bottom-4 bg-white shadow-lg border border-emerald-100 px-4 py-2 rounded-2xl text-[11px] font-black flex items-center gap-2 text-emerald-600">{isAiLoading ? <Icon name="Loader2" size={14} className="animate-spin"/> : <Icon name="BrainCircuit" size={14}/>} KI ANALYSE</button></div>
                                    <div className="grid grid-cols-2 gap-4"><div><label className="text-[10px] font-black uppercase mb-2 block tracking-widest ml-2">Menge (g)</label><input type="number" className="w-full bg-slate-50 rounded-2xl p-4 font-black outline-none border" value={amount} onChange={e => setAmount(e.target.value)}/></div><div><label className="text-[10px] font-black uppercase mb-2 block tracking-widest ml-2">Modus</label><select className="w-full bg-slate-50 rounded-2xl p-4 font-black outline-none border" value={calcMode} onChange={e => setCalcMode(e.target.value)}><option value="per100g">PRO 100G</option><option value="total">GESAMT</option></select></div></div>
                                    <div className="grid grid-cols-5 gap-2">{[{k:'kcal',l:'kcal'},{k:'protein',l:'P'},{k:'fat',l:'F'},{k:'carbs',l:'C'},{k:'fiber',l:'B'}].map(f => (<div key={f.k}><label className="text-[9px] font-black uppercase block mb-1 text-center">{f.l}</label><input type="number" step="0.1" className="w-full bg-slate-50 rounded-xl p-3 text-xs font-bold text-center border" value={quickTrack[f.k]} onChange={e => setQuickTrack({...quickTrack, [f.k]: e.target.value})}/></div>))}</div>
                                    <button type="submit" className="w-full bg-emerald-600 text-white font-black py-5 rounded-3xl shadow-xl text-lg">Hinzufügen</button>
                                </form>
                            </div>
                        </div>
                    )}

                    {(selectedFood || editingLog) && (
                        <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[60] flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-[56px] p-10 shadow-2xl animate-in zoom-in-95">
                                <h3 className="text-2xl font-black mb-8 leading-tight">{(selectedFood || editingLog).name}</h3>
                                <div className="bg-slate-50 rounded-[40px] p-8 text-center mb-8 border"><label className="text-[10px] font-black uppercase block mb-3">Gramm</label><input type="number" autoFocus className="w-full text-6xl font-black bg-transparent text-emerald-600 text-center outline-none" value={amount} onChange={e => setAmount(Math.max(0, parseInt(e.target.value) || 0))}/></div>
                                <div className="grid grid-cols-4 gap-2 mb-10 text-center border-y py-6"><div><p className="text-[9px] font-black text-slate-300">kcal</p><p className="font-bold text-orange-600">{Math.round((selectedFood || editingLog).calories * (amount/100))}</p></div><div><p className="text-[9px] font-black text-slate-300">P</p><p className="font-bold">{Math.round((selectedFood || editingLog).protein * (amount/100) * 10)/10}g</p></div><div><p className="text-[9px] font-black text-slate-300">C</p><p className="font-bold">{Math.round((selectedFood || editingLog).carbs * (amount/100) * 10)/10}g</p></div><div><p className="text-[9px] font-black text-slate-300">F</p><p className="font-bold">{Math.round((selectedFood || editingLog).fat * (amount/100) * 10)/10}g</p></div></div>
                                <div className="flex gap-4"><button onClick={() => {setSelectedFood(null); setEditingLog(null);}} className="flex-1 bg-slate-50 text-slate-400 font-black py-5 rounded-[24px]">ABBRUCH</button><button onClick={() => editingLog ? setLogs(logs.map(l => l.id === editingLog.id ? { ...l, amount } : l)) || setEditingLog(null) : addLogEntry(selectedFood, amount)} className="flex-[2] bg-emerald-600 text-white font-black py-5 rounded-[24px] shadow-lg">SPEICHERN</button></div>
                            </div>
                        </div>
                    )}

                    {showSettings && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-[48px] p-8 shadow-2xl animate-in zoom-in-95 max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-8"><h3 className="text-2xl font-black uppercase tracking-widest">Settings</h3><button onClick={() => setShowSettings(false)} className="bg-slate-100 p-2.5 rounded-full"><Icon name="X" size={20}/></button></div>
                                <div className="flex overflow-x-auto gap-3 pb-6 mb-6 border-b no-scrollbar">{[1,2,3,4,5,6,0].map(d => <button key={d} onClick={() => setSettingsDay(d)} className={`px-5 py-3 rounded-2xl text-xs font-black whitespace-nowrap ${settingsDay === d ? 'bg-emerald-600 text-white' : 'bg-slate-50 text-slate-400'}`}>{['So','Mo','Di','Mi','Do','Fr','Sa'][d]}</button>)}</div>
                                <div className="space-y-6">
                                    <div className="flex justify-between items-center"><span className="text-sm font-black uppercase">Tag: {['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'][settingsDay]}</span><button onClick={() => { const s = {...goals[settingsDay]}; const n = {}; [0,1,2,3,4,5,6].forEach(d => n[d] = {...s}); setGoals(n); showToast("Kopiert!"); }} className="text-[10px] font-black text-emerald-600 uppercase bg-emerald-50 px-4 py-2 rounded-xl"><Icon name="Copy" size={12} className="inline mr-1"/> Für alle</button></div>
                                    <div className="bg-emerald-50 p-6 rounded-[32px] border text-4xl font-black text-emerald-700">{goals[settingsDay].calories} <span className="text-sm font-medium opacity-50">kcal</span></div>
                                    <div className="grid grid-cols-2 gap-4">{[{k:'protein',l:'P'},{k:'carbs',l:'C'},{k:'fat',l:'F'},{k:'fiber',l:'B'}].map(m => (<div key={m.k}><label className="text-[9px] font-black text-slate-400 uppercase mb-2 block">{m.l} (g)</label><input type="number" className="w-full bg-slate-50 rounded-2xl p-4 font-black outline-none" value={goals[settingsDay][m.k]} onChange={e => { const v = parseInt(e.target.value)||0; const n = {...goals[settingsDay], [m.k]: v}; if(['protein','carbs','fat'].includes(m.k)) n.calories = Math.round((n.protein*4.1)+(n.carbs*4.1)+(n.fat*9.3)); setGoals({...goals, [settingsDay]: n}); }}/></div>))}</div>
                                    <button onClick={() => setShowSettings(false)} className="w-full bg-emerald-600 text-white font-black py-5 rounded-[24px] mt-6 shadow-xl">FERTIG</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {notification && <div className="fixed top-12 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-8 py-4 rounded-[24px] text-sm font-black flex items-center gap-4 z-[100] animate-in fade-in shadow-2xl"><div className="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>{notification}</div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>